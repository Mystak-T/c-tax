<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ³•äººç¨é‡‘è©¦ç®—ãƒ•ã‚©ãƒ¼ãƒ </title>
  <link href="https://cdn.jsdelivr.net/npm/sanitize.css" rel="stylesheet">
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f4f4f4; text-align: center; }
    h1 {
      color: #2c3e50;
      font-size: 1.5rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: inline-block;
      background: linear-gradient(to right, #6dd5ed, #2193b0);
      color: white;
      padding: 0.5em 1em;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    input, button { padding: 10px; margin: 10px 0; font-size: 1rem; width: 300px; max-width: 90%; }
    .result { background: #fff; padding: 1em; border-radius: 5px; display: inline-block; text-align: left; margin-top: 1em; }
    label { display: block; margin-top: 10px; text-align: left; max-width: 300px; margin-left: auto; margin-right: auto; }
    .image-container { display: flex; justify-content: center; margin: 1em 0; }
    .image-container img { width: 200px; height: auto; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .link { margin-top: 1em; font-size: 0.9rem; text-align: center; }
  </style>
</head>
<body>
  <h1>ğŸ“Š æ³•äººç¨ è©¦ç®—ã‚¢ãƒ—ãƒª ğŸ’¼</h1>

  <div class="image-container">
    <img src="zeikin.png" alt="ç¨ã®ãƒ‡ãƒ³ãƒ—ã‚·ãƒ¼ãƒ­ãƒ¼ãƒ«">
  </div>

  <label for="profit">å½“æœŸç´”åˆ©ç›Šï¼ˆå††ï¼‰:</label>
  <input type="text" id="profit" placeholder="ä¾‹ï¼š1,500,000" onblur="formatInput(this)"><br>

  <button onclick="calculateTax()">ç¨é¡ã‚’è©¦ç®—ã™ã‚‹</button>
  <div class="link">
    ğŸ‘‰ <a href="settings.html">ç¨ç‡ã®è¨­å®šã¯ã“ã¡ã‚‰</a>
  </div>

  <div class="result" id="output"></div>

  <script>
    function format(num) {
      return Math.round(num).toLocaleString();
    }

    function parseFormattedNumber(str) {
      return parseFloat(str.replace(/,/g, '')) || 0;
    }

    function getSetting(id, fallback = 0) {
      const val = localStorage.getItem(id);
      return parseFormattedNumber(val ?? fallback);
    }

    function formatInput(input) {
      const value = parseFormattedNumber(input.value);
      if (!isNaN(value)) {
        input.value = format(value);
      }
    }

    function calculateTax() {
      const profit = parseFormattedNumber(document.getElementById('profit').value);
      if (isNaN(profit) || profit <= 0) {
        document.getElementById('output').innerHTML = "æ­£ã—ã„é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      const corpTaxRate = getSetting('corpTaxRate', 15) / 100;
      const localCorpTaxRate = getSetting('localCorpTaxRate', 10.3) / 100;
      const cityTaxRate = getSetting('cityTaxRate', 6) / 100;
      const prefectureTaxRate = getSetting('prefectureTaxRate', 1) / 100;
      const cityFixed = getSetting('cityFixed', 50000);
      const prefectureFixed = getSetting('prefectureFixed', 21000);
      const businessTaxRate = getSetting('businessTaxRate', 3.5) / 100;
      const specialBusinessTaxRate = getSetting('specialBusinessTaxRate', 37) / 100;

      const corpTax = profit * corpTaxRate;
      const localCorpTax = corpTax * localCorpTaxRate;
      const businessTax = profit * businessTaxRate;
      const specialBusinessTax = businessTax * specialBusinessTaxRate;
      const cityTax = corpTax * cityTaxRate + cityFixed;
      const prefectureTax = corpTax * prefectureTaxRate + prefectureFixed;

      const nationalTotal = corpTax + localCorpTax;
      const prefecturalTotal = prefectureTax + businessTax + specialBusinessTax;
      const municipalTotal = cityTax;

      const totalTax = nationalTotal + prefecturalTotal + municipalTotal;

      document.getElementById('output').innerHTML = `
        <h2>è©¦ç®—çµæœ</h2>
        <ul>
          <li><strong>å›½ã¸ç´ç¨:</strong> ${format(nationalTotal)}å††ï¼ˆæ³•äººç¨: ${format(corpTax)}å††ã€åœ°æ–¹æ³•äººç¨: ${format(localCorpTax)}å††ï¼‰</li>
          <li><strong>çœŒã¸ç´ç¨:</strong> ${format(prefecturalTotal)}å††ï¼ˆæ³•äººçœŒæ°‘ç¨: ${format(prefectureTax)}å††ã€æ³•äººäº‹æ¥­ç¨: ${format(businessTax)}å††ã€ç‰¹åˆ¥æ³•äººäº‹æ¥­ç¨: ${format(specialBusinessTax)}å††ï¼‰</li>
          <li><strong>å¸‚ã¸ç´ç¨:</strong> ${format(municipalTotal)}å††ï¼ˆæ³•äººå¸‚æ°‘ç¨: ${format(cityTax)}å††ï¼‰</li>
          <li><strong>åˆè¨ˆç¨é¡: ${format(totalTax)}å††</strong></li>
        </ul>
      `;

      setTimeout(() => {
        document.getElementById('output').scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }
  </script>
</body>
</html>
